# å¹³å°æ”¿ç­–ç®¡ç†åŠŸèƒ½æŒ‡å—

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

å¹³å°æ”¿ç­–ç®¡ç†æ¨¡å—æ˜¯AIå®¢æœç³»ç»Ÿçš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œå…è®¸ç®¡ç†å‘˜åˆ›å»ºã€ç¼–è¾‘ã€å‘å¸ƒå’Œç®¡ç†å„ç±»å¹³å°æ”¿ç­–ã€‚è¯¥æ¨¡å—éµå¾ªç®€çº¦è®¾è®¡åŸåˆ™ï¼Œæä¾›å®Œæ•´çš„æ”¿ç­–ç”Ÿå‘½å‘¨æœŸç®¡ç†åŠŸèƒ½ã€‚

## ğŸ¯ ä¸»è¦åŠŸèƒ½

### 1. æ”¿ç­–ç±»å‹ç®¡ç†
- **é€€æ¢è´§æ”¿ç­–** (return_policy): å•†å“é€€æ¢è´§ç›¸å…³è§„å®š
- **éšç§æ”¿ç­–** (privacy_policy): ç”¨æˆ·éšç§ä¿æŠ¤æ¡æ¬¾
- **æœåŠ¡æ¡æ¬¾** (terms_of_service): å¹³å°æœåŠ¡ä½¿ç”¨åè®®
- **é…é€æ”¿ç­–** (shipping_policy): å•†å“é…é€ç›¸å…³è§„å®š
- **ä»˜æ¬¾æ”¿ç­–** (payment_policy): æ”¯ä»˜æ–¹å¼å’Œè§„åˆ™
- **è´¨é‡ä¿è¯** (quality_guarantee): å•†å“è´¨é‡ä¿éšœæ‰¿è¯º

### 2. å¯Œæ–‡æœ¬ç¼–è¾‘
- é›†æˆ Quill.js å¯Œæ–‡æœ¬ç¼–è¾‘å™¨
- æ”¯æŒæ–‡æœ¬æ ¼å¼åŒ–ï¼ˆç²—ä½“ã€æ–œä½“ã€ä¸‹åˆ’çº¿ï¼‰
- æ”¯æŒåˆ—è¡¨ã€æ ‡é¢˜ã€é“¾æ¥ç­‰å…ƒç´ 
- å®æ—¶é¢„è§ˆåŠŸèƒ½
- HTMLå†…å®¹å®‰å…¨è¿‡æ»¤

### 3. ç‰ˆæœ¬ç®¡ç†
- æ”¿ç­–ç‰ˆæœ¬å·ç®¡ç†ï¼ˆå¦‚ï¼š1.0ã€2.1ç­‰ï¼‰
- ç‰ˆæœ¬å†å²è®°å½•
- å‘å¸ƒçŠ¶æ€ç®¡ç†ï¼ˆè‰ç¨¿ã€å·²å‘å¸ƒã€å·²å½’æ¡£ï¼‰
- è‡ªåŠ¨ç‰ˆæœ¬æ›´æ–°æ—¶é—´è®°å½•

### 4. çŠ¶æ€ç®¡ç†
- **è‰ç¨¿** (draft): ç¼–è¾‘ä¸­çš„æ”¿ç­–ï¼Œæœªå¯¹å¤–å‘å¸ƒ
- **å·²å‘å¸ƒ** (active): å½“å‰ç”Ÿæ•ˆçš„æ”¿ç­–ç‰ˆæœ¬
- **å·²å½’æ¡£** (archived): å†å²ç‰ˆæœ¬æˆ–å·²åœç”¨çš„æ”¿ç­–

### 5. æœç´¢å’Œç­›é€‰
- æŒ‰æ”¿ç­–ç±»å‹ç­›é€‰
- æŒ‰çŠ¶æ€ç­›é€‰
- å…³é”®è¯æœç´¢ï¼ˆæ ‡é¢˜ã€å†…å®¹ã€æ‘˜è¦ï¼‰
- å®æ—¶æœç´¢ç»“æœæ›´æ–°

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### åç«¯ç»„ä»¶

#### æ•°æ®æ¨¡å‹ (Policy)
```python
class Policy(Base):
    id = Column(Integer, primary_key=True)
    policy_type = Column(String(50), nullable=False, index=True)
    title = Column(String(200), nullable=False)
    content = Column(Text, nullable=False)  # å¯Œæ–‡æœ¬HTML
    version = Column(String(20), nullable=False, default='1.0')
    status = Column(String(20), default='draft', index=True)
    summary = Column(String(500))  # æ”¿ç­–æ‘˜è¦
    keywords = Column(String(200))  # æœç´¢å…³é”®è¯
    created_by = Column(String(50), nullable=False)
    updated_by = Column(String(50))
    published_by = Column(String(50))
    created_at = Column(DateTime, default=datetime.utcnow)
    updated_at = Column(DateTime, default=datetime.utcnow)
    published_at = Column(DateTime)
```

#### ä¸šåŠ¡é€»è¾‘ (PolicyManager)
```python
class PolicyManager:
    # æ ¸å¿ƒæ–¹æ³•
    - get_all_policies(status=None)      # è·å–æ”¿ç­–åˆ—è¡¨
    - get_policy_by_id(policy_id)        # è·å–æ”¿ç­–è¯¦æƒ…
    - get_policy_by_type(policy_type)    # æŒ‰ç±»å‹è·å–æœ‰æ•ˆæ”¿ç­–
    - create_policy(policy_data, created_by)  # åˆ›å»ºæ–°æ”¿ç­–
    - update_policy(policy_id, policy_data, updated_by)  # æ›´æ–°æ”¿ç­–
    - delete_policy(policy_id, deleted_by)  # åˆ é™¤æ”¿ç­–ï¼ˆè½¯åˆ é™¤ï¼‰
    - publish_policy(policy_id, published_by)  # å‘å¸ƒæ”¿ç­–
    - search_policies(keyword, policy_type)  # æœç´¢æ”¿ç­–
    
    # å®‰å…¨ç‰¹æ€§
    - _clean_html_content(content)       # HTMLå†…å®¹å®‰å…¨è¿‡æ»¤
```

### APIæ¥å£

#### RESTful APIè®¾è®¡
```
GET    /api/admin/policies                    # è·å–æ”¿ç­–åˆ—è¡¨
GET    /api/admin/policies/types              # è·å–æ”¿ç­–ç±»å‹
GET    /api/admin/policies/<policy_id>        # è·å–æ”¿ç­–è¯¦æƒ…
GET    /api/admin/policies/type/<policy_type> # æŒ‰ç±»å‹è·å–æ”¿ç­–
POST   /api/admin/policies                    # åˆ›å»ºæ–°æ”¿ç­–
PUT    /api/admin/policies/<policy_id>        # æ›´æ–°æ”¿ç­–
DELETE /api/admin/policies/<policy_id>        # åˆ é™¤æ”¿ç­–
POST   /api/admin/policies/<policy_id>/publish # å‘å¸ƒæ”¿ç­–
GET    /api/admin/policies/search             # æœç´¢æ”¿ç­–
```

### å‰ç«¯ç•Œé¢

#### ç®¡ç†ç•Œé¢ç»„ä»¶
- **æ”¿ç­–åˆ—è¡¨é¡µé¢**: æ˜¾ç¤ºæ‰€æœ‰æ”¿ç­–ï¼Œæ”¯æŒç­›é€‰å’Œæœç´¢
- **æ”¿ç­–ç¼–è¾‘å™¨**: å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ï¼Œæ”¯æŒå®æ—¶é¢„è§ˆ
- **æ”¿ç­–é¢„è§ˆ**: æŸ¥çœ‹æ”¿ç­–æœ€ç»ˆæ˜¾ç¤ºæ•ˆæœ
- **æ¨¡æ€æ¡†**: åˆ›å»ºã€ç¼–è¾‘ã€é¢„è§ˆæ”¿ç­–çš„å¼¹çª—ç•Œé¢

#### å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ (Quill.js)
```html
<!-- CDNå¼•å…¥ -->
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>

<!-- ç¼–è¾‘å™¨å®¹å™¨ -->
<div id="policyEditor" style="height: 300px;"></div>
```

## ğŸ”’ å®‰å…¨ç‰¹æ€§

### 1. HTMLå†…å®¹å®‰å…¨è¿‡æ»¤
ä½¿ç”¨ `bleach` åº“æ¸…ç†ç”¨æˆ·è¾“å…¥çš„HTMLå†…å®¹ï¼š
```python
ALLOWED_TAGS = [
    'p', 'br', 'strong', 'em', 'u', 'ol', 'ul', 'li', 
    'h1', 'h2', 'h3', 'h4', 'h5', 'h6',
    'blockquote', 'a', 'img', 'table', 'thead', 'tbody', 'tr', 'td', 'th'
]

ALLOWED_ATTRIBUTES = {
    'a': ['href', 'title'],
    'img': ['src', 'alt', 'width', 'height'],
    'table': ['class'],
    'td': ['colspan', 'rowspan'],
    'th': ['colspan', 'rowspan']
}
```

### 2. æƒé™æ§åˆ¶
- ç®¡ç†å‘˜ç™»å½•è®¤è¯
- ä¼šè¯éªŒè¯
- æ“ä½œæƒé™æ£€æŸ¥

### 3. æ“ä½œæ—¥å¿—
- è®°å½•æ‰€æœ‰æ”¿ç­–æ“ä½œ
- åŒ…å«æ“ä½œè€…ã€æ“ä½œç±»å‹ã€ç›®æ ‡ã€æ—¶é—´ç­‰ä¿¡æ¯
- æ”¯æŒå®¡è®¡è¿½è¸ª

## ğŸŒ å›½é™…åŒ–æ”¯æŒ

### æ”¯æŒè¯­è¨€
- ç®€ä½“ä¸­æ–‡ (zh)
- è‹±æ–‡ (en)

### ç¿»è¯‘èŒƒå›´
- ç•Œé¢å…ƒç´ å®Œå…¨ç¿»è¯‘
- æ”¿ç­–å†…å®¹ä¿æŒä¸­æ–‡ï¼ˆæŒ‰ç”¨æˆ·è¦æ±‚ï¼‰
- æ”¿ç­–ç±»å‹åç§°ç¿»è¯‘

### ç¿»è¯‘ç¤ºä¾‹
```python
# æ”¿ç­–ç±»å‹ç¿»è¯‘
POLICY_TYPES = {
    'return_policy': 'é€€æ¢è´§æ”¿ç­–',
    'privacy_policy': 'éšç§æ”¿ç­–', 
    'terms_of_service': 'æœåŠ¡æ¡æ¬¾',
    'shipping_policy': 'é…é€æ”¿ç­–',
    'payment_policy': 'ä»˜æ¬¾æ”¿ç­–',
    'quality_guarantee': 'è´¨é‡ä¿è¯'
}
```

## ğŸ“± ç”¨æˆ·ç•Œé¢

### æ”¿ç­–ç®¡ç†é¡µé¢
- **è®¿é—®è·¯å¾„**: `/admin/policies`
- **åŠŸèƒ½**: æ”¿ç­–åˆ—è¡¨ã€æœç´¢ã€ç­›é€‰ã€æ“ä½œ
- **å“åº”å¼è®¾è®¡**: æ”¯æŒæ¡Œé¢å’Œç§»åŠ¨è®¾å¤‡

### æ“ä½œæµç¨‹
1. **åˆ›å»ºæ”¿ç­–**: é€‰æ‹©ç±»å‹ â†’ å¡«å†™æ ‡é¢˜ â†’ ç¼–è¾‘å†…å®¹ â†’ ä¿å­˜è‰ç¨¿
2. **ç¼–è¾‘æ”¿ç­–**: é€‰æ‹©æ”¿ç­– â†’ ä¿®æ”¹å†…å®¹ â†’ æ›´æ–°ç‰ˆæœ¬ â†’ ä¿å­˜
3. **å‘å¸ƒæ”¿ç­–**: é€‰æ‹©è‰ç¨¿ â†’ é¢„è§ˆç¡®è®¤ â†’ å‘å¸ƒä¸Šçº¿
4. **ç®¡ç†æ”¿ç­–**: æŸ¥çœ‹åˆ—è¡¨ â†’ ç­›é€‰æœç´¢ â†’ æ‰¹é‡æ“ä½œ

## ğŸš€ ä½¿ç”¨æŒ‡å—

### ç®¡ç†å‘˜æ“ä½œ

#### 1. åˆ›å»ºæ–°æ”¿ç­–
```javascript
// ç‚¹å‡»"æ·»åŠ æ”¿ç­–"æŒ‰é’®
admin.showPolicyModal();

// å¡«å†™æ”¿ç­–ä¿¡æ¯
- é€‰æ‹©æ”¿ç­–ç±»å‹
- è¾“å…¥æ”¿ç­–æ ‡é¢˜
- ç¼–å†™æ”¿ç­–å†…å®¹ï¼ˆå¯Œæ–‡æœ¬ï¼‰
- æ·»åŠ æ‘˜è¦å’Œå…³é”®è¯
- è®¾ç½®çŠ¶æ€ï¼ˆè‰ç¨¿/å‘å¸ƒï¼‰

// ä¿å­˜æ”¿ç­–
admin.savePolicyForm();
```

#### 2. ç¼–è¾‘ç°æœ‰æ”¿ç­–
```javascript
// ä»åˆ—è¡¨é€‰æ‹©æ”¿ç­–
admin.editPolicy(policyId);

// ä¿®æ”¹æ”¿ç­–å†…å®¹
- æ›´æ–°æ ‡é¢˜æˆ–å†…å®¹
- è°ƒæ•´ç‰ˆæœ¬å·
- ä¿®æ”¹çŠ¶æ€

// ä¿å­˜æ›´æ”¹
admin.updatePolicy();
```

#### 3. å‘å¸ƒæ”¿ç­–
```javascript
// å‘å¸ƒæ”¿ç­–ï¼ˆå°†åŒç±»å‹å…¶ä»–æ”¿ç­–å½’æ¡£ï¼‰
admin.publishPolicy(policyId);
```

### å¼€å‘è€…é›†æˆ

#### 1. è·å–æ”¿ç­–å†…å®¹
```javascript
// è·å–ç‰¹å®šç±»å‹çš„æœ‰æ•ˆæ”¿ç­–
fetch('/api/admin/policies/type/return_policy')
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      const policy = data.data;
      // ä½¿ç”¨æ”¿ç­–å†…å®¹
      displayPolicy(policy);
    }
  });
```

#### 2. æœç´¢æ”¿ç­–
```javascript
// æœç´¢æ”¿ç­–
fetch('/api/admin/policies/search?keyword=é€€è´§&policy_type=return_policy')
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      const policies = data.data;
      // æ˜¾ç¤ºæœç´¢ç»“æœ
      displaySearchResults(policies);
    }
  });
```

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒè¦æ±‚
- Python 3.8+
- Flask 2.3+
- SQLAlchemy 2.0+
- bleach 6.0+

### ä¾èµ–å®‰è£…
```bash
pip install bleach>=6.0.0
```

### æ•°æ®åº“åˆå§‹åŒ–
ç³»ç»Ÿå¯åŠ¨æ—¶ä¼šè‡ªåŠ¨åˆ›å»º `policies` è¡¨ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œã€‚

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### 1. æ•°æ®åº“ç´¢å¼•
- æ”¿ç­–ç±»å‹å’ŒçŠ¶æ€å¤åˆç´¢å¼•
- åˆ›å»ºæ—¶é—´å’Œå‘å¸ƒæ—¶é—´ç´¢å¼•
- å…¨æ–‡æœç´¢ä¼˜åŒ–

### 2. ç¼“å­˜ç­–ç•¥
- æœ‰æ•ˆæ”¿ç­–å†…å®¹ç¼“å­˜
- æœç´¢ç»“æœç¼“å­˜
- é™æ€èµ„æºç¼“å­˜

### 3. å‰ç«¯ä¼˜åŒ–
- å¯Œæ–‡æœ¬ç¼–è¾‘å™¨æŒ‰éœ€åŠ è½½
- å›¾ç‰‡æ‡’åŠ è½½
- åˆ†é¡µåŠ è½½

## ğŸ§ª æµ‹è¯•å»ºè®®

### åŠŸèƒ½æµ‹è¯•
1. åˆ›å»ºå„ç§ç±»å‹çš„æ”¿ç­–
2. æµ‹è¯•å¯Œæ–‡æœ¬ç¼–è¾‘å™¨åŠŸèƒ½
3. éªŒè¯HTMLå®‰å…¨è¿‡æ»¤
4. æµ‹è¯•æœç´¢å’Œç­›é€‰åŠŸèƒ½
5. éªŒè¯ç‰ˆæœ¬ç®¡ç†å’Œå‘å¸ƒæµç¨‹

### å®‰å…¨æµ‹è¯•
1. XSSæ”»å‡»é˜²æŠ¤æµ‹è¯•
2. æƒé™æ§åˆ¶æµ‹è¯•
3. è¾“å…¥éªŒè¯æµ‹è¯•

### æ€§èƒ½æµ‹è¯•
1. å¤§é‡æ”¿ç­–æ•°æ®åŠ è½½æµ‹è¯•
2. æœç´¢æ€§èƒ½æµ‹è¯•
3. å¹¶å‘æ“ä½œæµ‹è¯•

## ğŸ“š æ‰©å±•å»ºè®®

### åŠŸèƒ½æ‰©å±•
1. **æ”¿ç­–æ¨¡æ¿**: é¢„å®šä¹‰å¸¸ç”¨æ”¿ç­–æ¨¡æ¿
2. **å®¡æ‰¹æµç¨‹**: å¤šçº§å®¡æ‰¹æœºåˆ¶
3. **å®šæ—¶å‘å¸ƒ**: è®¾å®šæ”¿ç­–ç”Ÿæ•ˆæ—¶é—´
4. **å˜æ›´é€šçŸ¥**: æ”¿ç­–æ›´æ–°è‡ªåŠ¨é€šçŸ¥
5. **å¯¼å…¥å¯¼å‡º**: æ‰¹é‡å¯¼å…¥å¯¼å‡ºæ”¿ç­–

### æŠ€æœ¯ä¼˜åŒ–
1. **å…¨æ–‡æœç´¢**: é›†æˆElasticsearch
2. **ç‰ˆæœ¬å¯¹æ¯”**: æ”¿ç­–ç‰ˆæœ¬å·®å¼‚å¯¹æ¯”
3. **APIæ–‡æ¡£**: è‡ªåŠ¨ç”ŸæˆAPIæ–‡æ¡£
4. **ç›‘æ§å‘Šè­¦**: æ”¿ç­–è®¿é—®ç›‘æ§

## ğŸ“ å­¦ä¹ ä»·å€¼

è¿™ä¸ªå¹³å°æ”¿ç­–ç®¡ç†æ¨¡å—ä¸ºç¼–ç¨‹åˆå­¦è€…æä¾›äº†ä¸°å¯Œçš„å­¦ä¹ æœºä¼šï¼š

1. **Webå¼€å‘**: Flaskæ¡†æ¶ã€RESTful APIè®¾è®¡
2. **æ•°æ®åº“**: SQLAlchemy ORMã€æ•°æ®å»ºæ¨¡
3. **å‰ç«¯æŠ€æœ¯**: JavaScriptã€å¯Œæ–‡æœ¬ç¼–è¾‘å™¨é›†æˆ
4. **å®‰å…¨ç¼–ç¨‹**: XSSé˜²æŠ¤ã€è¾“å…¥éªŒè¯
5. **ç³»ç»Ÿè®¾è®¡**: æ¨¡å—åŒ–æ¶æ„ã€ç®€çº¦è®¾è®¡åŸåˆ™
6. **å›½é™…åŒ–**: å¤šè¯­è¨€æ”¯æŒå®ç°
7. **ç‰ˆæœ¬ç®¡ç†**: å†…å®¹ç‰ˆæœ¬æ§åˆ¶ç­–ç•¥

é€šè¿‡å­¦ä¹ å’Œä½¿ç”¨è¿™ä¸ªæ¨¡å—ï¼Œåˆå­¦è€…å¯ä»¥æ·±å…¥ç†è§£ç°ä»£Webåº”ç”¨çš„å¼€å‘æµç¨‹å’Œæœ€ä½³å®è·µã€‚
