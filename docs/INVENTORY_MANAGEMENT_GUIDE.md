# 📦 库存管理功能使用指南

## 🎯 功能概述

AI客服系统的库存管理模块提供了完整的库存管理解决方案，包括产品入库、库存盘点、数据对比分析等核心功能。本指南将详细介绍如何使用这些功能。

## 🚀 快速开始

### 访问库存管理系统

1. **启动系统**: `python app.py`
2. **访问管理后台**: http://localhost:5000/admin/login
3. **登录账户**: admin / admin123
4. **进入库存管理**: 点击侧边栏的库存管理相关菜单

## 📦 产品入库功能

### 功能入口
- **页面路径**: `/admin/inventory/products/add`
- **菜单位置**: 侧边栏 → 📦 产品入库

### 使用步骤

#### 1. 填写产品基本信息
```
产品名称*: 红富士苹果
产品分类*: 水果
价格*: 15.8元/斤
单位*: 斤
规格: 500g/个
存储区域*: A区 - 水果区
```

#### 2. 设置库存信息
```
初始库存: 100
最小库存警告: 10
产品描述: 香甜脆嫩的红富士苹果，产地新疆
产品图片URL: (可选)
```

#### 3. 条形码自动生成
- 输入产品名称和分类后，系统自动生成条形码预览
- 条形码格式：Code128
- 自动生成唯一编号：880000xxxxxx
- 条形码图片保存到 `static/barcodes/` 目录

#### 4. 提交保存
- 点击"保存产品"按钮
- 系统验证表单数据
- 成功后显示产品ID和条形码信息
- 自动清空表单，可继续添加新产品

### 功能特点
- ✅ **实时预览**: 输入信息后立即生成条形码预览
- ✅ **表单验证**: 必填字段检查、数据格式验证
- ✅ **存储区域**: 支持A-E区域分类存储
- ✅ **响应式设计**: 支持桌面和移动端操作

## 📊 库存盘点功能

### 功能入口
- **页面路径**: `/admin/inventory/counts`
- **菜单位置**: 侧边栏 → 📊 库存盘点

### 使用步骤

#### 1. 创建盘点任务
```
1. 点击"+ 创建新盘点"按钮
2. 输入盘点备注（可选）
3. 系统自动生成盘点ID：COUNT_YYYYMMDD_HHMMSS_随机数
4. 任务状态设置为"进行中"
```

#### 2. 添加盘点产品
**方式一：条形码扫描/输入**
```
1. 在"条形码扫描/输入"框中输入条形码
2. 点击"添加"按钮
3. 系统自动查找对应产品并添加到盘点列表
```

**方式二：产品搜索**
```
1. 在"产品搜索"框中输入产品名称
2. 点击"搜索"按钮
3. 从搜索结果中选择要盘点的产品
```

#### 3. 录入实际数量
```
1. 在盘点项目列表中找到对应产品
2. 在"实际数量"列输入实际盘点的数量
3. 系统自动计算差异：实际数量 - 账面数量
4. 差异显示：正数为盈余（绿色），负数为亏损（红色）
```

#### 4. 完成盘点
```
1. 确保所有产品都已录入实际数量
2. 查看盘点汇总统计
3. 点击"完成盘点"按钮
4. 系统生成盘点报告并更新任务状态
```

### 盘点数据结构
```json
{
  "count_id": "COUNT_20250610_143022_abc123",
  "status": "completed",
  "items": [
    {
      "product_name": "红富士苹果",
      "expected_quantity": 100,
      "actual_quantity": 95,
      "difference": -5
    }
  ],
  "summary": {
    "total_items": 10,
    "items_with_difference": 3,
    "total_difference_value": -50.0
  }
}
```

## 📈 数据对比分析功能

### 功能入口
- **页面路径**: `/admin/inventory/analysis`
- **菜单位置**: 侧边栏 → 📈 数据对比分析

### 使用步骤

#### 1. 选择分析类型

**周对比分析（推荐）**
```
1. 点击"生成周对比"按钮
2. 系统自动选择最近两次已完成的盘点任务
3. 一键生成周度库存变化分析报告
```

**手动对比分析**
```
1. 在"当前盘点"下拉框中选择较新的盘点任务
2. 在"对比盘点"下拉框中选择较早的盘点任务
3. 点击"开始对比"按钮
4. 系统生成自定义时间范围的对比分析
```

#### 2. 查看分析结果

**统计汇总卡片**
```
📦 总产品数: 显示参与对比的产品总数
📊 变化产品数: 显示有库存变化的产品数量
⚠️ 异常项目数: 显示超出正常变化范围的产品数
💰 总价值变化: 显示库存价值的总体变化
```

**变化明细表格**
```
- 产品名称、分类、存储区域
- 之前数量、当前数量、变化量
- 变化百分比、变化状态
- 支持按变化类型筛选（增加/减少/新增/移除）
```

**异常检测结果**
```
- 基于阈值的异常检测（默认50%变化率）
- 异常类型分类和严重程度评级
- 异常原因分析和处理建议
```

#### 3. 报表生成和下载

**分析报告下载**
```
1. 点击"📄 下载分析报告"按钮
2. 生成Markdown格式的详细分析报告
3. 包含统计汇总、变化明细、异常检测、管理建议
```

**Excel数据导出**
```
1. 点击"📊 导出Excel"按钮
2. 生成CSV格式的变化明细数据
3. 可用于进一步的数据分析和处理
```

## 🔧 高级功能

### 存储区域管理
```
A区 - 水果类产品
B区 - 蔬菜类产品  
C区 - 肉类产品
D区 - 海鲜类产品
E区 - 熟食类产品
```

### 条形码系统
```
格式: Code128
编号规则: 880000 + 6位数字
图片格式: PNG
存储路径: static/barcodes/
命名规则: 产品名称_条形码号.png
```

### 异常检测规则
```
变化百分比阈值: 50%
数量变化阈值: 20个
新增产品检测: 自动识别
移除产品检测: 自动识别
严重程度评级: 1-10级
```

## 📱 移动端使用

### 响应式设计特点
- **表单布局**: 桌面端双列 → 移动端单列
- **表格显示**: 支持横向滚动查看完整数据
- **按钮大小**: 适配触摸操作的按钮尺寸
- **字体大小**: 移动端友好的字体大小

### 移动端操作建议
1. **产品入库**: 建议使用平板或桌面端进行批量录入
2. **库存盘点**: 支持手机端扫码录入，便于现场操作
3. **数据分析**: 建议使用桌面端查看详细分析结果

## 🛠️ 故障排除

### 常见问题解决

**条形码生成失败**
```
1. 检查static/barcodes/目录是否存在
2. 确保目录有写入权限
3. 验证python-barcode库安装正确
```

**盘点数据丢失**
```
1. 检查data/inventory_counts.json文件
2. 确认JSON格式正确
3. 查看操作日志确认操作历史
```

**API调用失败**
```
1. 确认管理员登录状态
2. 检查网络连接
3. 查看浏览器开发者工具的错误信息
```

### 数据备份建议
```
1. 定期导出库存数据
2. 备份盘点任务数据
3. 保存重要的分析报告
4. 使用管理后台的数据导出功能
```

## 📞 技术支持

如需帮助，请：
1. 查看本使用指南
2. 检查系统日志信息
3. 运行API测试脚本
4. 参考主项目README.md文档

---

**文档版本**: v2.1.0  
**更新时间**: 2024年6月10日  
**适用系统**: AI客服系统库存管理模块
